
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma An√¥nima P2P</title>
  <script src="https://cdn.jsdelivr.net/npm/libp2p/dist/index.min.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 20px; }
    .post { border: 1px solid #ccc; padding: 15px; margin-bottom: 10px; background: white; }
    .controls { display: flex; gap: 10px; margin-top: 10px; }
    img { max-width: 100%; height: auto; margin-top: 10px; }
    textarea { width: 100%; height: 100px; }
    #feed { margin-top: 30px; }
  </style>
</head>
<body>

<h2>Postar Conte√∫do An√¥nimo</h2>
<textarea id="postText" placeholder="Escreva seu post..."></textarea>
<input type="file" id="imageInput" accept="image/*">
<div class="controls">
  <button onclick="payPost()">Pagar Post</button>
  <button onclick="submitPost()">Publicar</button>
</div>

<h2>Feed ao Vivo</h2>
<div id="feed"></div>

<script>
const feed = document.getElementById('feed');
let nodeId = Math.random().toString(36).substr(2, 9); // Simula ID √∫nico do usu√°rio via libp2p
let posts = [];

// Inicializar Libp2p (simula√ß√£o de conex√£o p2p)
async function initLibp2p() {
  const node = await Libp2p.create();
  await node.start();
  console.log('Libp2p iniciado com ID:', node.peerId.toB58String());
}

initLibp2p();

function submitPost() {
  const text = document.getElementById("postText").value;
  const imageFile = document.getElementById("imageInput").files[0];
  let imageUrl = "";

  if (imageFile) {
    const reader = new FileReader();
    reader.onload = () => {
      imageUrl = reader.result;
      createAndBroadcastPost(text, imageUrl);
    };
    reader.readAsDataURL(imageFile);
  } else {
    createAndBroadcastPost(text, null);
  }
}

function createAndBroadcastPost(text, imageUrl) {
  const post = {
    id: Date.now(),
    userId: nodeId,
    text: text,
    image: imageUrl,
    likes: 0,
    comments: []
  };

  posts.push(post);
  renderFeed();
  // Aqui voc√™ faria o broadcast via libp2p
  console.log("Broadcasting post:", post);
}

function payPost() {
  alert("Voc√™ pagou por este post!");
  // Integra√ß√£o real com carteira ou micropagamento aqui
}

function likePost(id) {
  const post = posts.find(p => p.id === id);
  post.likes += 1;
  renderFeed();
}

function addComment(id) {
  const commentText = prompt("Digite seu coment√°rio:");
  if (commentText) {
    const post = posts.find(p => p.id === id);
    post.comments.push({
      userId: nodeId,
      text: commentText
    });
    renderFeed();
  }
}

function renderFeed() {
  feed.innerHTML = '';
  posts.sort((a,b) => b.id - a.id).forEach(post => {
    const div = document.createElement('div');
    div.className = 'post';
    div.innerHTML = `
      <strong>ID An√¥nimo:</strong> ${post.userId}<br/>
      <p>${post.text}</p>
      ${post.image ? `<img src="${post.image}" alt="Imagem do post">` : ''}
      <div class="controls">
        <button onclick="likePost(${post.id})">‚ù§Ô∏è Like (${post.likes})</button>
        <button onclick="addComment(${post.id})">üí¨ Comentar</button>
      </div>
      <div style="margin-top:10px;">
        ${post.comments.map(c => `<div><strong>${c.userId}:</strong> ${c.text}</div>`).join('')}
      </div>
    `;
    feed.appendChild(div);
  });
}
</script>

</body>
</html>
