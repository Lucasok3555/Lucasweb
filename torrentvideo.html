<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Plataforma de Compartilhamento de Vídeo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tab {
            display: none;
            animation: fadeIn 0.5s;
        }
        .tab.active {
            display: block;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        input, video {
            width: 100%;
            margin: 10px 0;
        }
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Aba de Upload de Vídeo -->
        <div id="uploadTab" class="tab active">
            <h2>Upload de Vídeo</h2>
            <input type="file" id="videoInput" accept="video/*">
            <video id="videoPreview" controls style="display:none;"></video>
            <button onclick="previewVideo()">Pré-visualizar</button>
            <button onclick="uploadToFeed()">Enviar para o Feed</button>
        </div>

        <!-- Aba do Feed -->
        <div id="feedTab" class="tab">
            <h2>Feed de Vídeos</h2>
            <div id="videoFeed"></div>
        </div>

        <!-- Aba de Conexão WebRTC -->
        <div id="connectTab" class="tab">
            <h2>Conectar</h2>
            <button onclick="generateID()">Gerar Meu ID</button>
            <input type="text" id="myID" readonly>
            <input type="text" id="connectionID" placeholder="ID para conectar">
            <button onclick="connectPeer()">Conectar</button>
        </div>

        <!-- Navegação entre abas -->
        <div>
            <button onclick="showTab('uploadTab')">Upload</button>
            <button onclick="showTab('feedTab')">Feed</button>
            <button onclick="showTab('connectTab')">Conectar</button>
        </div>
    </div>

    <script>
        let localStream;
        let peerConnections = {};
        const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        // Gerenciamento de Abas
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // Pré-visualização de Vídeo
        function previewVideo() {
            const videoInput = document.getElementById('videoInput');
            const videoPreview = document.getElementById('videoPreview');
            
            if (videoInput.files.length > 0) {
                const file = videoInput.files[0];
                videoPreview.src = URL.createObjectURL(file);
                videoPreview.style.display = 'block';
            }
        }

        // Upload para o Feed
        function uploadToFeed() {
            const videoInput = document.getElementById('videoInput');
            const videoFeed = document.getElementById('videoFeed');
            
            if (videoInput.files.length > 0) {
                const file = videoInput.files[0];
                const videoElement = document.createElement('video');
                videoElement.src = URL.createObjectURL(file);
                videoElement.controls = true;
                videoFeed.appendChild(videoElement);
                
                // Salvar localmente
                localStorage.setItem('uploadedVideo', videoElement.src);
                
                showTab('feedTab');
            }
        }

        // Geração de ID único
        function generateID() {
            const myID = document.getElementById('myID');
            myID.value = 'user_' + Math.random().toString(36).substr(2, 9);
        }

        // Conexão WebRTC
        async function connectPeer() {
            const connectionID = document.getElementById('connectionID').value;
            
            try {
                // Solicitar acesso à câmera e microfone
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });

                // Criar conexão peer
                const peerConnection = new RTCPeerConnection(configuration);

                // Adicionar stream local
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });

                // Criar oferta
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);

                // Manipular candidatos ICE
                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        // Lógica para enviar candidatos (seria integrado com um servidor de sinalização)
                        console.log('Candidato ICE:', event.candidate);
                    }
                };

                // Armazenar conexão
                peerConnections[connectionID] = peerConnection;

                alert('Conexão iniciada com ' + connectionID);
            } catch (error) {
                console.error('Erro na conexão:', error);
            }
        }

        // Evento de carregamento
        window.onload = () => {
            // Carregar vídeo salvo do localStorage
            const savedVideoSrc = localStorage.getItem('uploadedVideo');
            if (savedVideoSrc) {
                const videoFeed = document.getElementById('videoFeed');
                const videoElement = document.createElement('video');
                videoElement.src = savedVideoSrc;
                videoElement.controls = true;
                videoFeed.appendChild(videoElement);
            }
        }
    </script>
</body>
</html>
